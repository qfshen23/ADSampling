import matplotlib.pyplot as plt

# 原始数据：每个列表长度应为 100（表示每个 gt kNN 的 bucket 命中数）
bucket_hits_k1024 = [2351, 2316, 2337, 2247, 2236, 2186, 2246, 2181, 2174, 2171, 2142, 2126, 2101, 2074, 2054, 2102, 2054, 2144, 2079, 2084, 2065, 2076, 2089, 2072, 2008, 2083, 2006, 1974, 2048, 1989, 2009, 2023, 1981, 1978, 1970, 1982, 1985, 1982, 1959, 1963, 1915, 1923, 1963, 1889, 1962, 1897, 1907, 1930, 1905, 1961, 1888, 1881, 1873, 1845, 1906, 1845, 1918, 1865, 1845, 1861, 1828, 1881, 1888, 1931, 1809, 1831, 1900, 1818, 1823, 1850, 1789, 1853, 1829, 1803, 1781, 1748, 1856, 1812, 1838, 1799, 1784, 1791, 1796, 1842, 1872, 1822, 1738, 1770, 1827, 1783, 1821, 1745, 1802, 1831, 1754, 1830, 1768, 1732, 1786, 1784]
bucket_hits_k512  = [2891, 2834, 2833, 2769, 2752, 2683, 2723, 2761, 2755, 2682, 2636, 2675, 2664, 2616, 2642, 2614, 2556, 2578, 2579, 2553, 2590, 2618, 2550, 2549, 2485, 2523, 2542, 2520, 2503, 2565, 2522, 2494, 2463, 2519, 2409, 2550, 2508, 2471, 2488, 2484, 2453, 2469, 2450, 2441, 2484, 2452, 2440, 2401, 2390, 2431, 2417, 2464, 2445, 2426, 2412, 2419, 2387, 2355, 2343, 2392, 2360, 2389, 2331, 2386, 2426, 2404, 2311, 2360, 2326, 2376, 2367, 2385, 2388, 2314, 2356, 2334, 2365, 2397, 2319, 2317, 2318, 2404, 2321, 2323, 2332, 2307, 2315, 2296, 2350, 2303, 2285, 2290, 2277, 2332, 2301, 2299, 2294, 2314, 2370, 2281]
bucket_hits_k256  = [3452, 3438, 3410, 3399, 3399, 3358, 3326, 3360, 3334, 3248, 3313, 3305, 3285, 3249, 3239, 3208, 3198, 3239, 3248, 3218, 3176, 3212, 3189, 3204, 3135, 3192, 3159, 3169, 3204, 3135, 3085, 3123, 3095, 3108, 3032, 3092, 3093, 3139, 3088, 3097, 3112, 3028, 3074, 3039, 3113, 3049, 3145, 3068, 3030, 3010, 3066, 3017, 3006, 3018, 3034, 3046, 3053, 3074, 3038, 2991, 3030, 3026, 3035, 2959, 3074, 2986, 2978, 3015, 2957, 3004, 2997, 3034, 3035, 2986, 2963, 2892, 3065, 2958, 2940, 2947, 3050, 2953, 2941, 2926, 2924, 2996, 2894, 2904, 2931, 2888, 2885, 2885, 2889, 2959, 2841, 3005, 2931, 2868, 2909, 2909]
bucket_hits_k64   = [5106, 5054, 5007, 5032, 5078, 4994, 4999, 5002, 4976, 4992, 4940, 4931, 4959, 4915, 4923, 4896, 4848, 4944, 4876, 4865, 4904, 4909, 4838, 4818, 4864, 4787, 4822, 4872, 4892, 4842, 4808, 4830, 4819, 4880, 4791, 4890, 4809, 4830, 4838, 4891, 4837, 4772, 4847, 4806, 4812, 4774, 4790, 4713, 4776, 4761, 4742, 4733, 4753, 4713, 4792, 4752, 4729, 4734, 4759, 4718, 4814, 4766, 4782, 4725, 4750, 4743, 4664, 4735, 4658, 4671, 4663, 4724, 4742, 4699, 4691, 4689, 4751, 4722, 4725, 4677, 4793, 4769, 4572, 4653, 4647, 4717, 4675, 4674, 4730, 4634, 4564, 4683, 4665, 4652, 4556, 4691, 4679, 4655, 4669, 4616]

# 放在 dict 方便循环处理
all_data = {
    "K=64": bucket_hits_k64,
    "K=256": bucket_hits_k256,
    "K=512": bucket_hits_k512,
    "K=1024": bucket_hits_k1024,
}

# Calculate average values for each dataset
averages = {}
for title, values in all_data.items():
    averages[title] = sum(values) / len(values)
    # print(f"Average for {title}: {averages[title]:.2f}")

# 绘图
fig, axes = plt.subplots(2, 2, figsize=(16, 10))
axes = axes.flatten()

for idx, (title, values) in enumerate(all_data.items()):
    ax = axes[idx]
    ax.bar(range(1, len(values)+1), values, color='skyblue')
    ax.set_title(f"Entry-GT kNN Bucket Count, {title}", fontsize=13)
    ax.set_xlabel("GT Neighbor Rank (1 to 100)")
    ax.set_ylabel("Hit Count")
    ax.grid(True)
    
    # Add average line and text
    avg = averages[title]
    ax.axhline(y=avg, color='red', linestyle='--', linewidth=1.5)
    ax.text(len(values)*0.75, avg*1.05, f'Avg: {avg:.2f}', 
            color='red', fontweight='bold')

plt.tight_layout()
plt.suptitle("Bucket Count Distribution for Entry-GT kNN under Different Cluster Counts", fontsize=16, y=1.03)
plt.savefig("Distribution_entry_gt_kNN.png", dpi=600)
